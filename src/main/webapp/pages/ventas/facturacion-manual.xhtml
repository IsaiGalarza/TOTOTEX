<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:mj="http://mojarra.dev.java.net/mojarra_ext"
    template="/WEB-INF/templates/templateModuloVentas.xhtml">

    <ui:define name="head">
    	<title>Facturacion</title>
    </ui:define>
    
    <ui:define name="header">
			
			
			
   	</ui:define>
   
    <ui:define name="content">
   				<ol class="breadcrumb">
					<li class="fuente-link-sidebar">
						<div class="lsf symbol">sitemap</div>
					</li>
					
					<li class="fuente-link-sidebar">
						<a href="/buffalo/">
							Inicio
						</a>
					</li>
					<li class="fuente-link-sidebar">
						<a href="/buffalo/pages/ventas/home.xhtml">
							Modulo Ventas
						</a>
					</li>
					<li><a
						class="fuente-link-sidebar"
						href="/buffalo/pages/ventas/facturacion-home.xhtml">Seleccionar Facturación</a></li>
					<li class="active" style="color: orange;">
						<a class="fuente-link-sidebar" style="color: orange;" href="/buffalo/pages/ventas/facturacion.xhtml">Facturación Manual</a>
					</li>
				</ol>
   	
   		<h:form id="formHearder">
		  	
		    <div class="row" style="padding: 0px 0px 0px 0px;">
				  
				  <div class="col-sm-6 col-md-3" align="left" >
				    
					<p:commandButton
					action="#{facturacionController.showModalAgregarConcepto()}"
					rendered="#{facturacionController.showButtonImpresion=='false'}"
					icon="ui-icon-plusthick" 
					style="cursor: pointer;
							    display: inline-block;
							    margin-right: 0.1em;
							    overflow: visible;
							    padding: 0;
							    position: relative;
							    text-align: center;
							    text-decoration: none !important;"
					value="Agregar Concepto" update=":formModalAgregarConcepto"
					oncomplete="PF('dlgAgregarConcepto').show()" styleClass="btn btn-primary btn-lg btn-block" />
				
				      
				      <h:panelGrid columns="2" style="border: 0px;">
				      	<h:column>
							
					  <p:graphicImage rendered="#{facturacionController.showButtonImpresion}" 
							value="#{facturacionController.urlCodeQR}" 
							width="150px;" height="150px;"/>
							
				      	</h:column>
				      	
				      	<h:column>
				    
				      		<a:region rendered="#{facturacionController.showButtonImpresion and facturacionController.newFactura.estado=='V'}">
				      			<span class="label label-success">Factura Valida</span>
				      			<br/>
				      		</a:region>
				      		<a:region rendered="#{facturacionController.showButtonImpresion and facturacionController.newFactura.estado=='E'}">
				      			<span class="label label-warning">Factura Extraviada</span>
				      			<br/>
				      		</a:region>
				      		<a:region rendered="#{facturacionController.showButtonImpresion and facturacionController.newFactura.estado=='A'}">
				      			<span class="label label-danger">Factura Anulada</span>
				      			<br/>
				      		</a:region>
				      		<a:region rendered="#{facturacionController.showButtonImpresion and facturacionController.newFactura.estado=='C'}">
				      			<span class="label label-danger">Factura Emitida Contingencia</span>
				      			<br/>
				      		</a:region>
				      		<a:region rendered="#{facturacionController.showButtonImpresion and facturacionController.newFactura.estado=='N'}">
				      			<span class="label label-default">Factura No Utilizada</span>
				      			<br/>
				      		</a:region>
				      		<h:outputText value="NIT: " rendered="#{facturacionController.showButtonImpresion}"  />
							<h:outputText value="#{facturacionController.usuarioSession.sucursal.nit}" rendered="#{facturacionController.showButtonImpresion}"  />
					  		<br/>
							<h:outputText value="Nro. Factura:" rendered="#{facturacionController.showButtonImpresion}"  />
							<h:outputText value="#{facturacionController.newFactura.numeroFactura}" rendered="#{facturacionController.showButtonImpresion}"  />
						  	<br/>
						  	<h:outputText value="Nro. Autorizacion:" rendered="#{facturacionController.showButtonImpresion}"  />
							<h:outputText value="#{facturacionController.usuarioSession.sucursal.numeroAutorizacion}" rendered="#{facturacionController.showButtonImpresion}"  />
					  	
				      	</h:column>
				      </h:panelGrid>
				      
				      
				  </div>
				
				  <div class="col-sm-6 col-md-3">
<!-- 				    	<button type="button" data-toggle="modal" data-target="#myModalProcesarFactura" class="btn btn-warning btn-lg btn-block">Procesar</button> -->
				    	<p:commandButton action="#{facturacionController.showModalProcesarFactura()}" 
				    		rendered="#{facturacionController.showButtonImpresion=='false'}"
				    		disabled="#{facturacionController.listaConcepto.size()>0? 'false' : 'true'}"
							icon="ui-icon-cart"
							style="cursor: pointer;
							    display: inline-block;
							    margin-right: 0.1em;
							    overflow: visible;
							    padding: 0;
							    position: relative;
							    text-align: center;
							    text-decoration: none !important;"
							value="Procesar" update=":formModalProcesar" oncomplete="PF('dlgProcesar').show()"  styleClass="btn btn-warning btn-lg btn-block" />
						
						
						<p:commandButton action="#{facturacionController.vistaPreviaFactura}" 
							rendered="#{facturacionController.showButtonImpresion and facturacionController.usuarioSession.impresionSilencionsa}"
							icon="ui-icon-print"
							style="cursor: pointer;
							    display: inline-block;
							    margin-right: 0.1em;
							    overflow: visible;
							    padding: 0;
							    position: relative;
							    text-align: center;
							    text-decoration: none !important;" oncomplete="PF('dlgVistaPrevia').show()"
								update=":formModalVistaPrevia"
							value="Imprimir Factura" styleClass="btn btn-warning btn-lg btn-block" >
						</p:commandButton>
						
						
			
						<br/><br/>
<!-- 						<p:inputTextarea id="respuestaRapidaID" styleClass="form-control" rendered="#{facturacionController.showButtonImpresion}"  -->
<!-- 							value="#{facturacionController.newFactura.codigoRespuestaRapida}" required="true" requiredMessage="Respuesta Rapida es Requerido." disabled="true"> -->
<!-- 							<p:ajax event="change" /> -->
<!-- 						</p:inputTextarea> -->
						
						<h:panelGrid  columns="4" rendered="#{facturacionController.showButtonImpresion}" >
					 
										 <div class="form-group" align="left">
										 <label for="facturaNitID" class="col-lg-2 control-label">NIT/CI</label>
										    <div class="col-lg-8">
										      <p:inputText id="facturaNitID" styleClass="form-control" value="#{facturacionController.newFactura.nitCi}" required="true" requiredMessage="NIT es Requerido." disabled="true">
												    	<p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="NIT / CI"  for="facturaNitID"/>
											  <p:message for="facturaNitID"/>
										    </div>
										  </div>
										  
										  <div class="form-group" align="left">
										    <label for="nombreClienteID" class="col-lg-2 control-label">CLIENTE</label>
										    <div class="col-lg-8">
										      <p:inputText id="nombreClienteID" styleClass="form-control" value="#{facturacionController.newFactura.nombreFactura}" size="40" required="true" requiredMessage="Cliente es Requerido." disabled="true">
												    	<p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="Nombre de Cliente"  for="nombreClienteID"/>
											  <p:message for="nombreClienteID"/>
										    </div>
										  </div>
						</h:panelGrid>
							
								
						
				  </div>
				  
				  <div class="col-sm-6 col-md-3">

				    	<p:commandButton action="#{facturacionController.buscarUltimas100Facturas()}" rendered="#{facturacionController.showButtonImpresion=='false'}"
							icon="ui-icon-search"
							style="cursor: pointer;
							    display: inline-block;
							    margin-right: 0.1em;
							    overflow: visible;
							    padding: 0;
							    position: relative;
							    text-align: center;
							    text-decoration: none !important;"
							value="Buscar Factura" update=":formModalBuscarFactura" oncomplete="PF('dlgBuscarFactura').show()"  
							styleClass="btn btn-primary btn-lg btn-block" />
						
						
						<p:commandButton action="#{facturacionController.anularFactura()}" 
							rendered="#{facturacionController.showButtonImpresion}"
							disabled="#{facturacionController.newFactura.estado=='A'}"
				    		onclick="return confirm('Esta seguro de anular esta Factura?');"
							icon="ui-icon-document"
							style="cursor: pointer;
							    display: inline-block;
							    margin-right: 0.1em;
							    overflow: visible;
							    padding: 0;
							    position: relative;
							    text-align: center;
							    text-decoration: none !important;"
							value="Anular Factura" update=":formFacturacion, :growl" oncomplete="PF('dlgBuscarPedido').show()"  styleClass="btn btn-danger btn-lg btn-block" />
				  		
						
						
						<br/><br/>
						
						<h:panelGrid columns="4" rendered="#{facturacionController.showButtonImpresion}" >
					 	
										 <div class="form-group" align="left">
										 <label for="facturaCCID" class="col-lg-6 control-label">CONTROL</label>
										    <div class="col-lg-4">
										      <p:inputText id="facturaCCID" styleClass="form-control" value="#{facturacionController.newFactura.codigoControl}" required="true" requiredMessage="NIT es Requerido." disabled="true">
												    	<p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="NIT / CI"  for="facturaCCID"/>
											  <p:message for="facturaCCID"/>
										    </div>
										  </div>
										  
										  <div class="form-group" align="left">
										    <label for="facturaFechaEmisionID" class="col-lg-6 control-label">FECHA</label>
										    <div class="col-lg-4">
										      <p:inputText id="facturaFechaEmisionID" styleClass="form-control" value="#{facturacionController.newFactura.fechaFactura}" size="40" required="true" requiredMessage="Fecha Emision es Requerido." disabled="true">
												    <f:convertDateTime pattern="dd/MM/yyyy H:mm"/>
												    <p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="Fecha Emision"  for="facturaFechaEmisionID"/>
											  <p:message for="facturaFechaEmisionID"/>
										    </div>
										  </div>
						</h:panelGrid>
					
				  </div>
				  <div class="col-sm-6 col-md-3">
<!-- 				    	<button type="button" data-toggle="modal" data-target="#modalNuevaFactura"  class="btn btn-success btn-lg btn-block">Nueva Factura</button> -->
				    	<p:commandButton action="#{facturacionController.nuevaFactura}" 
				    		onclick="return confirm('Desea salir y crear una nueva Factura?');"
				    		disabled="#{facturacionController.listaConcepto.size()>0? 'false' : 'true'}"
							icon="ui-icon-document"
							style="cursor: pointer;
							    display: inline-block;
							    margin-right: 0.1em;
							    overflow: visible;
							    padding: 0;
							    position: relative;
							    text-align: center;
							    text-decoration: none !important;"
							value="Nueva Factura" update=":formFacturacion" oncomplete="PF('dlgBuscarPedido').show()"  styleClass="btn btn-success btn-lg btn-block" />
				  		
				  		<br/><br/>
				  		
				  		<h:panelGrid  columns="4" rendered="#{facturacionController.showButtonImpresion}" >
										 <div class="form-group" align="left">
										 <label for="efectivoID" class="col-lg-2 control-label">EFECTIVO</label>
										    <div class="col-lg-8">
										      <p:inputText id="efectivoID" styleClass="form-control" value="#{facturacionController.efectivoFactura} Bs.-" required="true" requiredMessage="Efectivo es Requerido." disabled="true">
												    	<p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="Efectivo"  for="efectivoID"/>
											  <p:message for="efectivoID"/>
										    </div>
										  </div>
										  
										  <div class="form-group" align="left">
										    <label for="tarjetaID" class="col-lg-2 control-label">C/TARJETA</label>
										    <div class="col-lg-8">
										      <p:inputText id="tarjetaID" styleClass="form-control" value="#{facturacionController.newFactura.totalPagoDebito} Bs.-" size="40" disabled="true">
												    	<p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="Tarjeta Credito"  for="tarjetaID"/>
										    </div>
										  </div>
								</h:panelGrid>
				  		
				  		
				  		
				  	
				  </div>
		    </div>
		    
		    </h:form>
   		
   		
   		
   	
   	
   	 	
<!--     	<h:commandButton id="printCmdBtn" value="Print" type="button" icon="ui-icon-print" style="width:50px;float:right">   -->
<!--                     <p:printer  target="testBtn"  /> -->
<!--                 </h:commandButton>  -->
    	
<!--     	<p:commandButton value="Test Print" action="#" id="testBtn"></p:commandButton> -->
    	
<!--     	<p:media id="idReporteFactura" -->
<!-- 		    	 player="pdf" -->
<!-- 		    	 value="http://localhost:8080/buffalo/factura2?idFactura=39" width="500px" height="950px"/> -->
    	
		<h:form id="formFacturacion">
		<div class="btn-group btn-group-sm">
			
		<p:commandButton action="#{facturacionController.armarURLNotaVenta()}" 
							rendered="#{facturacionController.showButtonImpresion=='true'}"
							icon="ui-icon-print"
							style="cursor: pointer;
							    display: inline-block;
							    margin-right: 0.1em;
							    overflow: visible;
							    padding: 0;
							    position: relative;
							    text-align: center;
							    text-decoration: none !important;" oncomplete="PF('dlgVistaPreviaNV').show()"
								update=":formModalVistaPreviaNV"
							value="Imprimir Nota Venta" styleClass="btn btn-warning btn-lg btn-block" >
						</p:commandButton>
		
		</div>
			

			<style type="text/css">
				.ui-datatable-data-empty .ui-dt-c {
				    width: 100% !important;
				    color: red;
				  }
			</style>

		  	<div class="panel panel-default">
		      <!-- Default panel contents -->
		      <div class="panel-heading">
		      	<center><strong>DETALLE FACTURA</strong></center> 
		      </div>
		
		      <!-- Table -->
		      <div class="table-responsive">
		      			
		      			
		      			<p:dataTable rendered="#{facturacionController.showButtonImpresion=='false'}" styleClass="table table-condensed table-hover table-responsive table-striped table-bordered" 
		      				selection="#{facturacionController.selectedConcepto}" selectionMode="single" rowKey="#{_concepto.id}"
				        	emptyMessage="No hay elementos para poder facturar." rowIndexVar="item"
				        	id="tablaProductos" value="#{facturacionController.listaConcepto}" var="_concepto" >
				        	
				        	<p:ajax event="rowDblselect" oncomplete="PF('dlgModificarConcepto').show()"
				        		listener="#{facturacionController.onRowSelectConcepto}"
				        		update=":formModalConcepto"/>
				        		
				        	<p:ajax  event="rowSelect"
				        		listener="#{facturacionController.onRowSelectConceptoClick}" />	
				        	
				        	<p:column headerText="Item" >
				        		<CENTER>
				        		<a:region rendered="#{_concepto.tipo=='PRODUCTO'}">
				        			<span class="label label-primary"><h:outputText value="#{_concepto.codigo}" /></span>
				        		</a:region>
				        		<a:region rendered="#{_concepto.tipo=='SERVICIO'}">
				        			<span class="badge"><h:outputText value="#{item+1}" /></span>
				        		</a:region>
				        		<a:region rendered="#{_concepto.tipo=='PEDIDO'}">
				        			<span class="label label-warning"><h:outputText value="#{_concepto.codigo}" /></span>
				        		</a:region>
				        		
				        		<a:region rendered="#{_concepto.tipo=='PREPARADO'}">
				        			<span class="badge"><h:outputText value="#{_concepto.codigo}" /></span>
				        		</a:region>
				        		
				        		<a:region rendered="#{_concepto.tipo=='FARMACO'}">
				        			<span class="badge"><h:outputText value="#{_concepto.codigo}" /></span>
				        		</a:region>
				        		</CENTER>
				        	</p:column>
				        	<p:column headerText="Detalle">
				        		<h:outputText value="#{_concepto.concepto}" />
				        	</p:column>
				        	<p:column headerText="Cantidad" style="text-align: center;" >
				        		<span class="badge"><h:outputText value="#{_concepto.cantidad}" /></span>
				        	</p:column>
				        	<p:column headerText="P. Unitario">
				        		<h:outputText value="Bs.- "/>
				        		<h:outputText value="#{_concepto.precioUnitario}">
				        			<f:convertNumber pattern="#,##0.00"/>
				        		</h:outputText>
				        	</p:column>
				        	
				        	<p:column headerText="SubTotal" >
				        		<h:outputText value="Bs.- " style="text-align: right;"/>
				        		<h:outputText value="#{_concepto.precioTotal}" style="text-align: right;">
				        			<f:convertNumber pattern="#,##0.00"/>
				        		</h:outputText>
				        	</p:column>
				        </p:dataTable>
				       
				        
				        
				        <p:hotkey bind="Del" update=":formFacturacion, :growl, :formTotales" actionListener="#{facturacionController.quitarSeleccionadoListaConcepto()}"/>
				        
				        <p:dataTable rendered="#{facturacionController.showButtonImpresion}" styleClass="table table-condensed table-hover table-responsive table-striped table-bordered" 
		      				selection="#{facturacionController.selectedConcepto}" selectionMode="single" rowKey="#{_concepto.id}"
		      				emptyMessage="No hay elementos para poder facturar." rowIndexVar="item"
				        	id="tablaProductosFactura" value="#{facturacionController.listaConcepto}" var="_concepto" >
				        	
				        	<p:column headerText="Item">
				        		<CENTER>
				        		<a:region rendered="#{_concepto.tipo=='PRODUCTO'}">
				        			<span class="label label-primary"><h:outputText value="#{_concepto.codigo}" /></span>
				        		</a:region>
				        		<a:region rendered="#{_concepto.tipo=='SERVICIO'}">
				        			<span class="badge"><h:outputText value="#{item+1}" /></span>
				        		</a:region>
				        		<a:region rendered="#{_concepto.tipo=='PEDIDO'}">
				        			<span class="label label-warning"><h:outputText value="#{_concepto.codigo}" /></span>
				        		</a:region>
				        		
				        		<a:region rendered="#{_concepto.tipo=='PREPARADO'}">
				        			<span class="badge"><h:outputText value="#{_concepto.codigo}" /></span>
				        		</a:region>
				        		
				        		<a:region rendered="#{_concepto.tipo=='FARMACO'}">
				        			<span class="badge"><h:outputText value="#{_concepto.codigo}" /></span>
				        		</a:region>
				        		</CENTER>
				        	</p:column>
				        	<p:column headerText="Detalle">
				        		<h:outputText value="#{_concepto.concepto}" />
				        	</p:column>
				        	<p:column headerText="Cantidad" style="text-align: center;" >
				        		<span class="badge">
				        			<h:outputText value="#{_concepto.cantidad}" >
				        				<f:convertNumber pattern="#,##0.00"/>
				        			</h:outputText>
				        		</span>
				        	</p:column>
				        	<p:column headerText="P. Unitario" >
				        		<h:outputText value="Bs.- "/>
				        		<h:outputText value="Bs.- #{_concepto.precioUnitario}">
				        			<f:convertNumber pattern="#,##0.00"/>
				        		</h:outputText>
				        	</p:column>
				        	
				        	<p:column headerText="SubTotal">
				        		<h:outputText value="Bs.- " style="text-align: right;"/>
				        		<h:outputText value="#{_concepto.precioTotal}" style="text-align: right;">
				        			<f:convertNumber pattern="#,##0.00"/>
				        		</h:outputText>
				        	</p:column>
				        </p:dataTable>
		      </div>
		      
		      
		    </div>
		    
		    <div class="row" style="padding: 0px 0px 0px 0px;">
				  <div class="col-sm-12 col-md-0" align="left" >
					<a:region rendered="#{facturacionController.showButtonImpresion}">
						<h1><strong>SON: #{facturacionController.newFactura.totalLiteral}</strong></h1>
					</a:region>		  
				  </div>
			</div>
		    
		    
		    
		   
			
		</h:form>
		
		
		<h:form id="formTotales">
    	<a:outputPanel ajaxRendered="true">
    	<div class="row">
	    	<div class="col-sm-6 col-md-3">
			    <div class="well">
					<center><h1>Cambio Bs</h1></center>
				</div>
			</div>
			<div class="col-sm-6 col-md-3">
			    <div class="well">
					<center>
						<h1><strong>
							<h:outputText value="#{facturacionController.newFactura.cambio}" >
								<f:convertNumber pattern="#,##0.00"/>
							</h:outputText>
					</strong></h1>
					</center>
				</div>
			</div>
			<div class="col-sm-6 col-md-3">
			    <div class="well">
					<center>
						<h1>Total Bs</h1>
					</center>
				</div>
			</div>
			<div class="col-sm-6 col-md-3">
			    <div class="well">
					<center>
						<h1><strong>
						<h:outputText value="#{facturacionController.totalBolivianos}" >
							<f:convertNumber pattern="#,##0.00"/>
						</h:outputText>
					</strong></h1>
					</center>
				</div>
			</div>
		</div>
		</a:outputPanel>
		
		
<!-- 		<p:lightBox>   -->
<!-- 		    <h:outputLink value="#">   -->
<!-- 		        <p:commandButton action="#" -->
<!-- 							value="Imprimir Factura" styleClass="btn btn-danger btn-lg btn-block" /> -->
<!-- 		    </h:outputLink>   -->
		
<!-- 		    <f:facet name="inline">   -->
<!-- 		    	<p:media value="/resources/other/factura.pdf" width="450px" height="700px"/> -->
		       
<!-- 		    </f:facet>   -->
<!-- 		</p:lightBox>   -->
<!-- 		<p:lightBox>   -->
<!-- 		    <h:outputLink value="#">   -->
<!-- 		        <p:commandButton action="#" -->
<!-- 							value="Imprimir Factura 2 #{facesContext.externalContext.requestContextPath}" styleClass="btn btn-default btn-lg btn-block" /> -->
<!-- 		    </h:outputLink>   -->
		
<!-- 		    <f:facet name="inline">   -->
<!-- 		    	<p:media id="idReporteFactura" -->
<!-- 		    	 player="pdf" -->
<!-- 		    	 value="http://localhost:8080/buffalo/factura2?idFactura=39" width="500px" height="950px"/> -->
		       
<!-- 		    </f:facet>   -->
<!-- 		</p:lightBox>   -->
		
		</h:form>
		
		
		
		<!-- MODAL BUSCAR PEDIDO -->	 	 
		   <p:dialog showEffect="explode" header="Buscar Nota Venta" widgetVar="dlgBuscarPedido" 
		   		resizable="false" modal="true"  position="center"
		   		width="900" styleClass="customDialog"
		   		visible="#{not empty facesContext.maximumSeverity}" id="modalPedidoID">  
				
				<div class="modal-body">
			    	<h:form id="formModalBuscarPedido">
						
			    		<div class="panel-body" style="padding: 0px 0px 0px 0px;">
			        	<div class="row">
			        		  <div class="col-sm-12 col-md-12" align="left" >
						  <h:panelGrid columns="3">
						  		<h:inputText id="notaVentaID" size="40" value="#{facturacionController.notaVenta}" styleClass="form-control" />
					      		<p:watermark value="Nota de Venta"  for="notaVentaID"/>
					      		<p:commandButton value="Buscar" styleClass="btn btn-default" 
					      			icon="ui-icon-search"
					      			update=":formModalBuscarPedido" action="#{facturacionController.buscarPedido()}" />
						  </h:panelGrid>
					     </div>
					     </div>
					</div>
					<br/>
					<!-- Default panel contents -->
		      		<div class="panel panel-default">
				    <!-- Default panel contents -->
				    <div class="panel-heading">Ultimos Pedidos</div>
					
					<p:dataTable styleClass="table table-condensed table-hover table-responsive table-striped table-bordered" 
							paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
	       					rowsPerPageTemplate="5 10" first="0"
		      				selection="#{facturacionController.selectNotaVenta}" selectionMode="single" rowKey="#{_nv.id}"
				        	id="tablaNV" value="#{facturacionController.listaUltimosPedidoModal}" var="_nv" 
				        	paginator="true" rows="5">
				        	
				        	<p:ajax event="rowDblselect" 
				        		listener="#{facturacionController.onRowSelectNotaVenta}"
				        		update=":formModalBuscarPedido:tableResultPedidos"/>
				        	
				        	<p:column headerText="Nota Venta">
				        		<span class="label label-warning"><h:outputText value="#{_nv.notaVenta}" /></span>
				        	</p:column>
				        	<p:column headerText="Proforma">
				        		<h:outputText value="#{_nv.proforma}" />
				        	</p:column>
				        	<p:column headerText="Fecha Venta" style="text-align: center;">
				        		<h:outputText value="#{_nv.fechaPago}" />
				        	</p:column>
				        	<p:column headerText="Cliente" style="text-align: left;">
				        		<h:outputText value="#{_nv.cliente}"/>
				        	</p:column>
				        	<p:column headerText="Total">
				        		<h:outputText value="Bs.- #{_nv.montoTotal}" style="text-align: right;"/>
				        	</p:column>
				        </p:dataTable>
						</div>
		
			
					    <!-- Default panel contents -->
		      			<div class="panel panel-default">
				        <!-- Default panel contents -->
				        <div class="panel-heading">Lista de Productos</div>
				        <p:dataTable styleClass="table table-condensed table-hover table-responsive table-striped table-bordered" 
				        	id="tableResultPedidos" value="#{facturacionController.listaPedidoModal}" var="_pedido">
				        	<p:column headerText="Nota Venta">
				        		<span class="label label-warning"><h:outputText value="#{_pedido.notaVenta}" /></span>
				        	</p:column>
				        	<p:column headerText="Producto" style="text-align: left;">
				        		<h:outputText value="#{_pedido.nomPreparado}" />
				        	</p:column>
				        	<p:column headerText="Cantidad" style="text-align: center;">
				        		<span class="badge"><h:outputText value="#{_pedido.cantidadEnvase}" /></span>
				        	</p:column>
				        	<p:column headerText="PU" >
				        		<h:outputText value="Bs.- #{_pedido.precioUnitPreElab}"/>
				        	</p:column>
				        	<p:column headerText="Descuento">
				        		<h:outputText value="Bs.- #{_pedido.valorDescuento}" style="text-align: right;"/>
				        	</p:column>
				        	<p:column headerText="Total">
				        		<h:outputText value="Bs.- #{_pedido.valorPreparado}" style="text-align: right;"/>
				        	</p:column>
				        	<p:column headerText="" style="text-align: center;">
				        		<p:selectBooleanCheckbox value="#{_pedido.selected}">
				        			<p:ajax event="change"/>
				        		</p:selectBooleanCheckbox>
				        	</p:column>
				        </p:dataTable>
				        </div>
				        
				
				</h:form>
				</div>
				
		    	
		    	<div class="modal-footer">
		    		<p:commandButton value="Cancelar" 
				    			icon="ui-icon-minus"
				    			onclick="PF('dlgBuscarPedido').hide()" action="#" />
			        <p:commandButton value="Agregar Pedido" 
			        			icon="ui-icon-plusthick"
					      		update=":formHearder, formFacturacion:tablaProductos, formTotales" action="#{facturacionController.cargarPedido()}" 
					      		oncomplete="PF('dlgBuscarPedido').hide()"/>
			      </div>
				
		   </p:dialog>
		   
		   
		   
		   <!-- MODAL BUSCAR PRODUCTO -->	 	 
		   <p:dialog showEffect="explode" header="Buscar Producto" widgetVar="dlgBuscarProducto" 
		   		resizable="false" modal="true"  position="center"
		   		width="1100" styleClass="customDialog"
		   		visible="#{not empty facesContext.maximumSeverity}" id="modalProductoID">  
				
				<div class="modal-body">
			      	<h:form id="formModalBuscarProducto">
					  	
			    		<div class="panel-body" style="padding: 0px 0px 0px 0px;">
			        	<div class="row">
			        		  <div class="col-sm-12 col-md-12" align="left" >
						  <h:panelGrid columns="3">
						  		<h:inputText size="40" id="descripcionProductoID" value="#{facturacionController.descripcionProducto}" styleClass="form-control" >
					      		
					      		</h:inputText>
					      		<p:watermark value="Descripcion Producto"  for="descripcionProductoID"/>
					      		<p:commandButton value="Buscar" styleClass="btn btn-default" 
					      			icon="ui-icon-search"
					      			update="tableResultProductos" action="#{facturacionController.buscarProductosV2}" />
						  </h:panelGrid>	
					      </div>
					      </div>
						</div>
					    <br/>
			
					    <!-- Default panel contents -->
		      			<div class="panel panel-default">
				        <!-- Default panel contents -->
				        <div class="panel-heading">Lista de Productos</div>
				        
				        <p:dataTable styleClass="table table-condensed table-hover table-responsive table-striped table-bordered" 
				        	paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				        	rowsPerPageTemplate="5 10" first="0" rows="5" paginator="true"
				        	id="tableResultProductos" value="#{facturacionController.listaProductoModal}" var="_producto">
				        	
				        	<p:column headerText="Codigo">
				        		<span class="label label-primary"><h:outputText value="#{_producto.codigoProducto}" /></span>
				        	</p:column>
				        	<p:column headerText="Descripcion" style="text-align: left;">
				        		<h:outputText value="#{_producto.nombre2}" />
				        	</p:column>
				        	<p:column headerText="Cantidad" style="text-align: center;">
				        		<span class="badge"><h:outputText value="#{_producto.cantidad}" /></span>
				        	</p:column>
				        	<p:column headerText="PU" >
				        		<h:outputText value="Bs.- #{_producto.precioUnitarioVenta}"/>
				        	</p:column>
				        	<p:column headerText="Total">
				        		<h:outputText value="Bs.- #{_producto.costoTotal}" style="text-align: right;"/>
				        	</p:column>
				        	<p:column headerText="Stock" >
				        		<span class="badge alert-danger"><h:outputText value="0.0" rendered="#{_producto.stockActual=='0'}" /></span>
				        		<span class="badge alert-danger"><h:outputText value="0.0" rendered="#{_producto.stockActual=='0.0'}" /></span>
				        		<span class="badge alert-danger"><h:outputText value="0.0" rendered="#{_producto.stockActual=='0.00'}" /></span>
				        		<h:outputText value="#{_producto.stockActual}" rendered="#{_producto.stockActual!='0.0'}" />
				        	</p:column>
				        	<p:column headerText="Seleccionar" style="text-align: center;">
				        		<p:selectBooleanCheckbox value="#{_producto.selected}">
				        			<p:ajax event="change"/>
				        		</p:selectBooleanCheckbox>
				        	</p:column>
				        </p:dataTable>
					    
		                </div>
		            	
		            </h:form>
		            
			      </div>
				
		    	  <div class="modal-footer">
		    	  	<p:commandButton value="Cancelar" 
				    			icon="ui-icon-minus"
				    			onclick="PF('dlgBuscarProducto').hide()" action="#" />
			        <p:commandButton value="Agregar Producto"
			        			icon="ui-icon-plusthick"
					      		update="formHearder, formFacturacion:tablaProductos, formTotales" action="#{facturacionController.agregarProducto()}" 
					      		oncomplete="PF('dlgBuscarProducto').hide()"/>
			      </div>
				
		   </p:dialog>
		   
		   
		   <!-- MODAL BUSCAR SERVICIO -->	 	 
		   <p:dialog showEffect="explode" header="Buscar Servicio" widgetVar="dlgBuscarServicio" 
		   		resizable="false" modal="true"  position="center"
		   		width="900" styleClass="customDialog"
		   		visible="#{not empty facesContext.maximumSeverity}" id="modalServicioID">  
				
				<div class="modal-body">
			      	<h:form id="formModalBuscarServicio">
					 	
			    		<div class="panel-body" style="padding: 0px 0px 0px 0px;">
			        	<div class="row">
			        		  <div class="col-sm-12 col-md-12" align="left" >
						  <h:panelGrid columns="3">
						  		<h:inputText id="criterioServicioID" size="40" value="#{facturacionController.descripcionServicio}" styleClass="form-control" />
					      		<p:watermark value="Nombre del Servicio"  for="criterioServicioID"/>
					      		<p:commandButton value="Buscar" styleClass="btn btn-default" 
					      			icon="ui-icon-search"
					      			update=":formModalBuscarServicio" action="#{facturacionController.buscarServicio()}" />
						  </h:panelGrid>
					    </div>
					    </div>
					    </div>
					    <br/>
			
					    <!-- Default panel contents -->
		      			<div class="panel panel-default">
				        <!-- Default panel contents -->
				        <div class="panel-heading">Lista de Servicios</div>
				        <p:dataTable styleClass="table table-condensed table-hover table-responsive table-striped table-bordered" 
				        	paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				        	rowsPerPageTemplate="5 10" first="0" rows="5" paginator="true"
				        	id="tableResultServicios" value="#{facturacionController.listaServicioModal}" var="_servicio">
				        	<p:column headerText="Codigo">
				        		<span class="label label-success"><h:outputText value="SER-#{_servicio.servicio.id}" /></span>
				        	</p:column>
				        	<p:column headerText="Descripcion" style="text-align: left;">
				        		<h:outputText value="#{_servicio.servicio.nombreServicio}" />
				        	</p:column>
				        	<p:column headerText="Cantidad" style="text-align: center;">
				        		<span class="badge"><h:outputText value="#{_servicio.cantidad}" /></span>
				        	</p:column>
				        	<p:column headerText="PU" >
				        		<h:outputText value="Bs.- #{_servicio.servicio.precioUnitarioVenta}"/>
				        	</p:column>
				        	<p:column headerText="SubTotal">
				        		<h:outputText value="Bs.- #{_servicio.subTotal}" style="text-align: right;"/>
				        	</p:column>
				        	
				        	<p:column headerText="" style="text-align: center;">
				        		<p:selectBooleanCheckbox value="#{_servicio.selected}">
				        			<p:ajax event="change"/>
				        		</p:selectBooleanCheckbox>
				        	</p:column>
				        </p:dataTable>
					    
		                </div>
		            	
		            </h:form>
		            
			      </div>
				
		    	  <div class="modal-footer">
		    	  	<p:commandButton value="Cancelar" 
				    			icon="ui-icon-minus"
				    			onclick="PF('dlgBuscarServicio').hide()" action="#" />
			        <p:commandButton value="Agregar Servicio"
			        			icon="ui-icon-plusthick"
					      		update="formHearder, formFacturacion:tablaProductos, formTotales" action="#{facturacionController.agregarServicio()}" 
					      		oncomplete="PF('dlgBuscarServicio').hide()"/>
			      </div>
				
		   </p:dialog>
		   
		   <!-- MODAL MODIFICAR CONCEPTO -->	 	 
		   <p:dialog showEffect="explode" header="Modificar Concepto" widgetVar="dlgModificarConcepto" 
		   		resizable="false" modal="true"  position="center"
		   		styleClass="customDialog"
		   		visible="#{not empty facesContext.maximumSeverity}" id="modalConceptoID">  
			     	
			      	<h:form id="formModalConcepto" >
					
					<h:panelGrid columns="6">	
					
					    <label for="conceptoID">Concepto</label>
					    <p:inputText id="conceptoID" value="#{facturacionController.selectedConcepto.concepto}">
					    	<p:ajax event="change" />
					    </p:inputText>
					  	<p:message for="conceptoID"/>
						
						<label for="cantidadID">Cantidad</label>
					   	<p:spinner id="cantidadID" value="#{facturacionController.selectedConcepto.cantidad}">
					   		<p:ajax event="change" update="subTotalID"/>
					   	</p:spinner>
						<p:message for="cantidadID"/>
						
						<label for="pUnitarioID">P. Unitario</label>
					   	<p:spinner id="pUnitarioID" value="#{facturacionController.selectedConcepto.precioUnitario}" disabled="true"/>
						<p:message for="pUnitarioID"/>
						
						<label for="subTotalID">SubTotal</label>
					    <p:spinner id="subTotalID" value="#{facturacionController.selectedConcepto.precioTotal}" disabled="true"/>
					    <p:message for="subTotalID"/>
						
					</h:panelGrid>
					
					
		            </h:form>
				
		    	  <div class="modal-footer">
		    	  	<p:commandButton value="Cancelar" 
				    			icon="ui-icon-minus"
				    			onclick="PF('dlgModificarConcepto').hide()" action="#" />
			        <p:commandButton value="Guardar"
			        			icon="ui-icon-disk"
					      		update="formFacturacion:tablaProductos, formTotales" action="#{facturacionController.modificarConcepto()}" 
					      		oncomplete="PF('dlgModificarConcepto').hide()"/>
			      </div>
		    	
		   </p:dialog>
		   
		   
		   
		   
		   <!-- MODAL PROCESAR -->	 	 
		   <p:dialog showEffect="explode" header="FACTURACIÓN" widgetVar="dlgProcesar" 
		   		resizable="false" modal="true"  position="center"
		   		width="700" styleClass="customDialog" 
		   		visible="#{not empty facesContext.maximumSeverity}" id="modalProcesarID">  
				
				<h:form id="formModalProcesar">		   
		   
		   
		   
	    	<script type="text/javascript">
			    function handleDialogSubmit(xhr, status, args) {
			        if (args.validationFailed) {
			        	dlgProcesar.show();
			        } else {
			        	dlgProcesar.hide();
			        }
			    }
			</script>
						
						<p:outputPanel autoUpdate="true">
						<h:panelGrid columns="4">
					 
										 <div class="form-group" align="left">
										 <label for="nitID" class="col-lg-2 control-label">NIT/CI</label>
										    <div class="col-lg-8">
										      <p:inputText id="nitID" styleClass="form-control" value="#{facturacionController.newFactura.nitCi}" 
										      	required="true" requiredMessage="NIT es Requerido." validatorMessage="NIT Invalido.">
										      		<f:validateLength maximum="13"/>
										      		<f:validateRegex pattern="[0-9]+" />
												    <p:ajax event="change" listener="#{facturacionController.recordarDatosCliente()}" />
											  </p:inputText>
											  <p:watermark value="NIT / CI"  for="nitID"/>
											  <p:message for="nitID"/>
										    </div>
										  </div>
										  
										  <div class="form-group" align="left">
										    <label for="nombreClienteID" class="col-lg-2 control-label">CLIENTE</label>
										    <div class="col-lg-8">
										      <p:inputText  id="nombreClienteID" styleClass="form-control" value="#{facturacionController.newFactura.nombreFactura}" size="40" required="true" requiredMessage="Cliente es Requerido.">
												    	<p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="Nombre de Cliente"  for="nombreClienteID"/>
											  <p:message for="nombreClienteID"/>
										    </div>
										  </div>
						</h:panelGrid>
						</p:outputPanel>
						<br/>
					
						<div class="tabbable tabs-left">
							  <ul class="nav nav-tabs span2">
							    <li class="active"><a href="#tabs5-pane1" data-toggle="tab"><STRONG>Pago Efectivo</STRONG></a></li>
							    <li><a href="#tabs5-pane2" data-toggle="tab"><STRONG>Pago Tarjeta</STRONG></a></li>
							  </ul>
							  <div class="tab-content span5">
							    <div id="tabs5-pane1" class="tab-pane active">
							      	<br/>
							      	<h:panelGrid columns="4">
					  					  
										  <div class="form-group" align="left" >
											    <label for="totalBSID" class="col-lg-2 control-label"><span class="label label-default">PAGAR BS</span></label>
											    <div class="col-lg-8">
											      <p:inputText id="totalBSID" styleClass="form-control" value="#{facturacionController.totalBolivianos}" size="30" disabled="true">
													    	<p:ajax event="change" />
													    	<f:convertNumber pattern="#,##0.00"/>
												  </p:inputText>
												  <p:watermark value="Total Bs"  for="totalBSID"/>
												  <p:message for="totalBSID"/>
											    </div>
										  </div>
										 
										  <div class="form-group" align="left">
										    <label for="entregadoID" class="col-lg-2 control-label"><span class="label label-primary">EFECTIVO BS</span></label>
										    <div class="col-lg-8">
										      <p:inputText id="entregadoID" styleClass="form-control" value="#{facturacionController.totalEntregadoString}" size="30" 
										      		validatorMessage="Monto Invalido.">
												    <p:ajax event="change" update="cambioID, cambio2ID" listener="#{facturacionController.calcularCambioDevolucionString}"/>
												    <f:convertNumber pattern="#,##0.00"/>
										      		<f:validateDoubleRange minimum="0"/>
										      		<p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="Total Entregado BS"  forElement="entregadoID" for="entregadoID"/>
											  <p:message for="entregadoID"/>
										    </div>
										  </div>
										  
										  <div class="form-group" align="left">
										    <label for="entregadoUSDID" class="col-lg-2 control-label"><span class="label label-success">EFECTIVO USD</span></label>
										    <div class="col-lg-8">
										      <p:inputText id="entregadoUSDID" styleClass="form-control" value="#{facturacionController.totalEntregadoDolaresString}" size="30" validatorMessage="Monto Invalido.">
												    <p:ajax event="change" update="cambioID, cambio2ID" listener="#{facturacionController.calcularCambioDevolucionString}"/>
												    <f:convertNumber pattern="#,##0.00"/>
										      		<f:validateDoubleRange minimum="0"/>
										      		<p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="Total Entregado USD" forElement="entregadoUSDID" for="entregadoUSDID"/>
											  <p:message for="entregadoUSDID"/>
										    </div>
										  </div>
										  
										  
										  <div class="form-group" align="left">
										    <label for="cambioID" class="col-lg-2 control-label"><span class="label label-warning">CAMBIO</span></label>
										    <div class="col-lg-8">
											  <p:inputText id="cambioID" styleClass="form-control" value="#{facturacionController.totalCambioString}" 
										      	size="30" required="true" requiredMessage="Falta Ingresar Pago." validatorMessage="Saldo Pendiente.">
										      		<f:convertNumber pattern="#,##0.00"  />
										      		<f:validateDoubleRange minimum="0"/>
											  		<p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="Cambio"  for="cambioID"/>
											  <p:message for="cambioID"/>
										    </div>
										  </div>
										  
										  </h:panelGrid>
							      		<br/>
							    </div>
							    <div id="tabs5-pane2" class="tab-pane">
							    		<br/>
							    		<h:panelGrid columns="4">
					  						
					  					  <div class="form-group" align="left" >
											    <label for="total2BSID" class="col-lg-2 control-label"><span class="label label-default">PAGAR BS</span></label>
											    <div class="col-lg-8">
											      <p:inputText id="total2BSID" styleClass="form-control" value="#{facturacionController.totalBolivianos}" size="30" disabled="true">
													    	<p:ajax event="change" />
													    	<f:convertNumber pattern="#,##0.00"/>
												  </p:inputText>
												  <p:watermark value="Total Bs"  for="total2BSID"/>
												  <p:message for="total2BSID"/>
											    </div>
										  </div>
					  						
					  						
										  <div class="form-group" align="left">
										    <label for="entregadoID" class="col-lg-2 control-label"><span class="label label-primary">NRO COMPROBANTE</span></label>
										    <div class="col-lg-8">
										      <p:inputText id="comprobanteID" styleClass="form-control" value="#{facturacionController.newFactura.comprobanteDebito}" size="30">
												    	<p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="Numero de Comprobante"  for="comprobanteID"/>
											  <p:message for="comprobanteID"/>
										    </div>
										  </div>
										  
										  <div class="form-group" align="left">
										    <label for="entregadoDebitoID" class="col-lg-2 control-label"><span class="label label-success">DEBITO BS</span></label>
										    <div class="col-lg-8">
										      <p:inputText id="entregadoDebitoID" styleClass="form-control" value="#{facturacionController.totalEntregadoDebito}" size="30">
												    	<p:ajax event="change" update="cambio2ID, cambioID" listener="#{facturacionController.calcularCambioDevolucionString}"/>
											  </p:inputText>
											  <p:watermark value="Total Debitado"  for="entregadoDebitoID"/>
											  <p:message for="entregadoDebitoID"/>
										    </div>
										  </div>
										  
										  <div class="form-group" align="left">
										    <label for="cambio2ID" class="col-lg-2 control-label"><span class="label label-warning">CAMBIO</span></label>
										    <div class="col-lg-8">
										      <p:inputText id="cambio2ID" styleClass="form-control" value="#{facturacionController.totalCambioString}" 
										      	size="30" required="true"  requiredMessage="Falta Ingresar Pago." validatorMessage="Saldo Pendiente.">
										      		<f:convertNumber pattern="#,##0.00"/>
										      		<f:validateDoubleRange minimum="0"/>
											  		<p:ajax event="change" />
											  </p:inputText>
											  <p:watermark value="Cambio"  for="cambio2ID"/>
											  <p:message for="cambio2ID"/>
										    </div>
										  </div>
										  
										  
										  </h:panelGrid>
										  <br/>
										  
							    </div>
							    
							   </div>
							   
							</div>
							
						 <div class="modal-footer">
					        <p:commandButton value="Cancelar" 
				    			icon="ui-icon-minus"
				    			onclick="PF('dlgProcesar').hide()" action="#" />
					        <p:commandButton value="Facturar" ajax="true"
					        			icon="ui-icon-cart"
							      		update=":formTotales, :formHearder, :formFacturacion, :formModalProcesar, :growl" 
							      		action="#{facturacionController.registrarFacturaConcepto()}" 
							      		oncomplete="handleDialogSubmit(xhr, status, args)"/>
							      		
					     </div>
					     
					     </h:form>
		   </p:dialog>
		    
			
		   <!-- MODAL BUSCAR FACTURA -->	 	 
		   <p:dialog showEffect="explode" header="Buscar Factura" widgetVar="dlgBuscarFactura" 
		   		resizable="false" modal="true"  position="center"
		   		width="900" styleClass="customDialog"
		   		visible="#{not empty facesContext.maximumSeverity}" id="modalFacturaID">  
				
				<div class="modal-body">
			    	<h:form id="formModalBuscarFactura">
			    		<div class="panel-body" style="padding: 0px 0px 0px 0px;">
			        	<div class="row">
			        		  <div class="col-sm-12 col-md-12" align="left" >
						  <h:panelGrid columns="3">
						  		<h:inputText size="40" id="razonSocialID" value="#{facturacionController.criterioBusquedaFactura}" styleClass="form-control" >
					      		
					      		</h:inputText>
					      		<p:watermark value="CI/NIT o Nombre Cliente"  for="razonSocialID"/>
					      		<p:commandButton value="Buscar Factura" styleClass="btn btn-default" 
					      			icon="ui-icon-search"
					      			update="tablaFacturas" action="#{facturacionController.buscarFactura}" />
						</h:panelGrid>
					        </div>	
					    </div>					    
					   </div>
					<br/>
					<!-- Default panel contents -->
		      		<div class="panel panel-default">
				    <!-- Default panel contents -->
				    <div class="panel-heading">Ultimas Facturas</div>
					
					
					<p:dataTable styleClass="table table-condensed table-hover table-responsive table-striped table-bordered" 
							paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
	       					rowsPerPageTemplate="5 10" first="0"
		      				selection="#{facturacionController.selectedFactura}" selectionMode="single" rowKey="#{_fact.id}"
				        	id="tablaFacturas" value="#{facturacionController.listaUltimasFacturas}" var="_fact" 
				        	paginator="true" rows="5">
				        
				        		
				        	<p:ajax  event="rowSelect"
				        		listener="#{facturacionController.onRowSelectFacturaClick}" />
				        	
				        	<p:column headerText="#Factura">
				        		<span class="label label-warning"><h:outputText value="#{_fact.numeroFactura}" /></span>
				        	</p:column>
				        	<p:column headerText="NIT/CI">
				        		<h:outputText value="#{_fact.nitCi}" />
				        	</p:column>
				        	<p:column headerText="Nombre Cliente" style="text-align: left;">
				        		<h:outputText value="#{_fact.nombreFactura}"/>
				        	</p:column>
				        	<p:column headerText="Fecha Factura" style="text-align: center;">
				        		<h:outputText value="#{_fact.fechaFactura}" >
				        			<f:convertDateTime locale="ES" pattern="dd/MM/yyyy H:mm"/>
				        		</h:outputText>
				        	</p:column>
				        	<p:column headerText="Total">
				        		<h:outputText value="Bs.- #{_fact.totalPagar}" style="text-align: right;"/>
				        	</p:column>
				        	<p:column headerText="Estado" style="text-align: left;">
				        		<a:region rendered="#{_fact.estado=='V'}">
				        			<span class="label label-success">Valida</span>
				        		</a:region>
				        		<a:region rendered="#{_fact.estado=='A'}">
				        			<span class="label label-danger">Anulada</span>
				        		</a:region>
				        		
				        		<a:region rendered="#{_fact.estado=='E'}">
				        			<span class="label label-warning">Extraviada</span>
				        		</a:region>
				        		<a:region rendered="#{_fact.estado=='C'}">
				        			<span class="label label-danger">Emitida Contingencia</span>
				        		</a:region>
				        		<a:region rendered="#{_fact.estado=='N'}">
				        			<span class="label label-default">No Utilizada</span>
				        		</a:region>
				        		
				        		
				        	</p:column>
				        </p:dataTable>
						</div>
		
				        
				
				</h:form>
				</div>
				
		    	
		    	<div class="modal-footer">
		    		<p:commandButton value="Cancelar" 
		    			icon="ui-icon-minus"
		    			onclick="PF('dlgBuscarFactura').hide()" action="#" />
			        <p:commandButton value="Cargar Factura" 
			        			icon="ui-icon-plus"
					      		update=":formHearder, :formFacturacion, :formTotales" action="#{facturacionController.cargarFactura}" 
					      		oncomplete="PF('dlgBuscarFactura').hide()"/>
			      </div>
				
		   </p:dialog>
		   
		   
		   <!-- MODAL SELECCIONAR IMPRESORA-->	 	 
		   <p:dialog showEffect="explode" header="Seleccionar Impresora" widgetVar="dlgSeleccionarImpresora" 
		   		resizable="false" modal="true"  position="center"
		   		styleClass="customDialog"
		   		visible="#{not empty facesContext.maximumSeverity}" id="modalSeleccionarImpresoraID">  
				
				<div class="modal-body">
			    	<h:form id="formModalSeleccionarImpresora">
					<div class="row">
					<p:panelGrid columns="2">
						<h:outputText value="Impresora: " />
						<h:selectOneMenu id="impresoraID"  value="#{facturacionController.selectedImpresora}" effect="fade" required="true" 
					      			requiredMessage="Impresora es Requerida.">  
						            <f:selectItems value="#{facturacionController.listaImpresora}" var="_print"  
						            	itemLabel="#{_print.nombre}" itemValue="#{_print.nombre}"/>  
						            <p:ajax event="change" update="impresoraID"/>
						</h:selectOneMenu>
					</p:panelGrid>
					
					</div>
				
				</h:form>
				</div>
				
		    	
		    	<div class="modal-footer">
		    		<p:commandButton value="Cancelar" 
		    			icon="ui-icon-minus"
		    			onclick="PF('dlgSeleccionarImpresora').hide()" action="#" />
			        <p:commandButton value="Imprimir" 
			        			icon="ui-icon-print"
					      		update=":formHearder, formFacturacion:tablaProductos, formTotales" action="#{facturacionController.impresionAtendida}" 
					      		oncomplete="PF('dlgSeleccionarImpresora').hide()"/>
			      </div>
				
				
		   </p:dialog>
		   
		 <!-- VISTA PREVIA FACTURA -->
		<p:dialog showEffect="explode" header="Vista Previa" widgetVar="dlgVistaPrevia" 
		   		resizable="false" modal="true"  position="center"
		   		width="750" styleClass="customDialog"
		   		visible="#{not empty facesContext.maximumSeverity}" id="modalVistaPrevia">  
			
				<div class="modal-body">
					
					<h:form id="formModalVistaPrevia">
					
					<p:media id="idReporteFactura" player="pdf" 
							value="#{facturacionController.urlFactura}"
							width="700px" height="500px" />
					
					</h:form>
				</div>				

				<div class="modal-footer">
				
					<div class="btn-group btn-group-sm">
					
						<p:commandButton value="Cerrar"  style="width: 150px;"
					    			icon="ui-icon-minus"
					    			action="#" styleClass="btn btn-default"
					    			onclick="PF('dlgVistaPrevia').hide()" />
						
					</div>	
				
				</div>

		</p:dialog>	
		
		<p:dialog showEffect="explode" header="Vista Previa" widgetVar="dlgVistaPreviaNV" 
		   		resizable="false" modal="true"  position="center"
		   		width="750" styleClass="customDialog"
		   		visible="#{not empty facesContext.maximumSeverity}" id="modalVistaPreviaNV">  
			
				<div class="modal-body">
					
					<h:form id="formModalVistaPreviaNV">
					
					<p:media id="idReporteNotaVenta" player="pdf" 
							value="#{facturacionController.urlNotaVenta}"
							width="700px" height="500px" />
					
					</h:form>
				</div>				

				<div class="modal-footer">
				
					<div class="btn-group btn-group-sm">
					
						<p:commandButton value="Cerrar"  style="width: 150px;"
					    			icon="ui-icon-minus"
					    			action="#" styleClass="btn btn-default"
					    			onclick="PF('dlgVistaPreviaNV').hide()" />
						
					</div>	
				
				</div>

		</p:dialog>	
		
		   <!-- MODAL AGREGAR CONCEPTO -->
		<p:dialog showEffect="explode" header="Agregar Concepto"
			widgetVar="dlgAgregarConcepto" resizable="false" modal="true"
			position="center" width="900" styleClass="customDialog"
			visible="#{not empty facesContext.maximumSeverity}"
			id="modalAgregarConceptoID">

			

				<div class="modal-body">
				
				<h:form id="formModalAgregarConcepto">
				
					<script type="text/javascript">
			    function handleDialogSubmit(xhr, status, args) {
			        if (args.validationFailed) {
			        	dlgAgregarConcepto.show();
			        } else {
			        	dlgAgregarConcepto.hide();
			        }
			    }
			</script>

					<div class="row">
						<div class="col-sm-6 col-md-6" align="left"
							style="padding: 2px 2px 2px 2px;">
							<p:message for="newConceptoID" />
							<h:panelGrid columns="2">
								<label for="newConceptoID">Concepto</label>

								<p:inputTextarea id="newConceptoID"
									value="#{facturacionController.newConcepto.concepto}" rows="5"
									cols="50" required="true" requiredMessage="Requerido.">
									<p:ajax event="change" />
								</p:inputTextarea>

							</h:panelGrid>

						</div>

						<div class="col-sm-6 col-md-6" align="left"
							style="padding: 2px 2px 2px 2px;">

							<h:panelGrid columns="3">

								<label for="newCantidadID">Cantidad</label>
								<p:spinner id="newCantidadID"
									value="#{facturacionController.newConcepto.cantidad}"
									required="true" requiredMessage="Requerido.">
									<p:ajax event="change" listener="#{facturacionController.actualizarPrecio()}" update="newSubTotalID" />
								</p:spinner>
								<p:message for="newCantidadID" />

								<label for="pNewUnitarioID">P_Unitario</label>
								<p:spinner id="pNewUnitarioID"
									value="#{facturacionController.newConcepto.precioUnitario}"
									required="true" requiredMessage="Requerido." validatorMessage="Invalido.">
									<f:validateDoubleRange minimum="1"/>
									<p:ajax event="change" listener="#{facturacionController.actualizarPrecio()}" update="newSubTotalID" />
								</p:spinner>
								<p:message for="pNewUnitarioID" />

								<label for="newSubTotalID">SubTotal</label>
								<p:spinner id="newSubTotalID"
									value="#{facturacionController.newConcepto.precioTotal}"
									disabled="true" />
								<p:message for="newSubTotalID" />

							</h:panelGrid>

						</div>
					</div>
					
				</h:form>
					
				</div>

				<div class="modal-footer">
					<p:commandButton value="Cancelar" icon="ui-icon-minus"
						onclick="PF('dlgAgregarConcepto').hide()" action="#" />
					<p:commandButton value="Agregar" icon="ui-icon-plusthick"
						update=":formHearder, formFacturacion:tablaProductos, formTotales"
						action="#{facturacionController.agregarConcepto()}"
						oncomplete="handleDialogSubmit(xhr, status, args)" />
				</div>


			


		</p:dialog>
		   
    </ui:define>
    
    
    <ui:define name="footer">
    	
		
		
    </ui:define>
    
    
   
    
    
</ui:composition>